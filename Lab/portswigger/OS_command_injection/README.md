# OS command injection
* [OS Command injection là gì ?](#khainiem)
* [Lab: OS command injection, simple case ](#lab1)
* [Lab: Blind OS command injection with time delays](#lab2)
* [Lab: Blind OS command injection with output redirection](#lab3)
* [Lab: Blind OS command injection with out-of-band interaction](#lab4)
* [Lab: Blind OS command injection with out-of-band data exfiltration](#lab5)
* [Một số các để injection command](#lab6)
# OS Command injection là gì ? <a name="khainiem">
  >Là một lỗ hổng cho phép chèn các command line của hệ điều hành và và thực thi nó trên máy chủ.
  <br>Đối với dạng đơn giản nhất thì khi ta chèn command line và thực thi thì trong phần HTTP response sẽ cho ra kết quả của command line ta chèn vào.
  <br>Blind thì khác mặc dù cũng chèn command line và cũng thực thi nhưng trong phần HTTP response không sẽ trả về kết quả của command line.
# Lab: OS command injection, simple case <a name="lab1">
  >Theo lab mô tả thì web có chứa chức năng thực hiện một command line có với 2 params  product and store ID sẽ trả về kết quả trong response
  ![image](https://user-images.githubusercontent.com/20487674/121918227-0c30a080-cd60-11eb-9634-50de8df8b15e.png)
  <br>Thấy params productId thì thử chèn một số command line và kết quả không thành công
  ![image](https://user-images.githubusercontent.com/20487674/121918851-a1339980-cd60-11eb-8ea2-f1c7390bd591.png)
  <br>Tìm endpoint khác<br>
  ![image](https://user-images.githubusercontent.com/20487674/121919146-ebb51600-cd60-11eb-8ca0-ee4cc76a25ab.png)
  <br>Lần này có vẻ khả quan :))
  ![image](https://user-images.githubusercontent.com/20487674/121919395-2f0f8480-cd61-11eb-8323-fc01ba3f9817.png)
  <br>Tiếp tục thử inject vào params storeId thì thành công
  ![image](https://user-images.githubusercontent.com/20487674/121920183-ff14b100-cd61-11eb-93a5-99a928bdf600.png)
# Lab: Blind OS command injection with time delays <a name="lab2">
  >Theo lab mô tả web có chứa chức năng thực hiện một command line  chứa detail do người dùng nhập và trong phần HTTP response không sẽ trả về kết quả của command line
  ![image](https://user-images.githubusercontent.com/20487674/121926756-7e0ce800-cd68-11eb-9b58-5a34b6776477.png)
  <br>Bắt request thực hiện fuzzing từng params ở Post body payload thì thử ping 8.8.8.8 (dns google nha) do lệnh ping có khoảng thời gian thực cho đến thực hiện xong 
  thì ta có thể độ thời gian phản hồi cho có thể cho biết lệnh ping đó có được thực thi hay không
  ![image](https://user-images.githubusercontent.com/20487674/121927618-7732a500-cd69-11eb-9b34-2f37a6c1cc07.png)
  ![image](https://user-images.githubusercontent.com/20487674/121928272-2e2f2080-cd6a-11eb-9f60-76698324f44e.png)
  <br>Cho đến paramas email thì cho kết quả thời gian phản hồi rất khá lớn so với các params trước đó ,từ đây có thể xác định được lệnh ping đã được thực thi
  ![image](https://user-images.githubusercontent.com/20487674/121929606-90d4ec00-cd6b-11eb-8e75-8eef83bb56b2.png)
# Lab: Blind OS command injection with output redirection <a name="lab3">
  >Theo mô tả lab này chỉ chúng ta các truy xuất kết quả đầu ra command line đối với dạng blind bằng cách chuyển kết quả của command line vào 1 file,ở đây lab có cung cấp
  path: /var/www/images/
  ![image](https://user-images.githubusercontent.com/20487674/122161230-8a459200-ce9b-11eb-8390-0615c3b26c8e.png)
  <br>Tìm file trên web kết quả không thấy file
  ![image](https://user-images.githubusercontent.com/20487674/122161336-c0831180-ce9b-11eb-8d2f-a37ad3438cb6.png)
  <br>Tiếp tục view-source, đến đây ta thấy parameter filename từ đây có thể LFI<br>
  ![image](https://user-images.githubusercontent.com/20487674/122161723-66cf1700-ce9c-11eb-86bf-3ff40595425d.png)
  ![image](https://user-images.githubusercontent.com/20487674/122161458-f4f6cd80-ce9b-11eb-9e17-82240f9a0585.png)
  ![image](https://user-images.githubusercontent.com/20487674/122161899-c6c5bd80-ce9c-11eb-9f2e-aacfa245a36c.png)
 # Lab: Blind OS command injection with out-of-band interaction <a name="lab4">
  >Theo mô tả thì lab sử dụng truy vấn dns thay vì sử dụng lệnh ping để xác định command line có được thi hay không
  thì lab này cho ta sử dụng Burp Collaborator để cung cấp web server, để thực truy vấn dns đến web server của Burp Collaborator
  để xài Burp Collaborator thì chọn tab Burp -> Burp Collaborator Client<br>
  ![image](https://user-images.githubusercontent.com/20487674/122163191-f4136b00-ce9e-11eb-9fb9-2d9751a6a3be.png)
  Nhấn Copy to clibboard để copy web server mà Burp Collaborator cung cấp,Sau khi thực hiện truy vấn dns
  ![image](https://user-images.githubusercontent.com/20487674/122163473-769c2a80-ce9f-11eb-9f0e-215cd8a5d947.png)
  Trở về tab Burp Collaborator Client ,nhấn Poll now xem kết quả từ có thể xác command đã được thực thi
  ![image](https://user-images.githubusercontent.com/20487674/122163716-d09cf000-ce9f-11eb-874e-5af83c37eb74.png)
# Lab: Blind OS command injection with out-of-band data exfiltration <a name="lab5">
  >Theo mô tả lab này hướng dẫn chúng ta trích xuất kết quả đầu thông qua truy vấn dns
  thì ta có thử hiện injection command thông qua backtick `command`<br>
  ![image](https://user-images.githubusercontent.com/20487674/122164234-aac41b00-cea0-11eb-87a9-f3d399ef83eb.png)
  ![image](https://user-images.githubusercontent.com/20487674/122164771-769d2a00-cea1-11eb-841d-ccdc860b77b9.png)
# Một số các để injection command <a name="lab6">
  1.Sử dụng Logical Operators
  * &
  * &&
  * |
  * ||
  
  2.Sử dụng %0A hoặc 0x0a , \n để xuống dòng và sử dụng dấu ; ví dụ: command;command<br>
    3.Sử dụng  backticks và $
  * \`command\`
  * $(command)
  
  4.Sử dụng ${variable}
    ![image](https://user-images.githubusercontent.com/20487674/122166425-d0065880-cea3-11eb-90a1-c767bd2a6f38.png)

> Nguồn:<br>
  [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection)<br>
  [https://book.hacktricks.xyz/pentesting-web/command-injection#what-is-command-injection](https://book.hacktricks.xyz/pentesting-web/command-injection#what-is-command-injection)
  

  
  


  
  
  


  
  
  

  
  

  





  
